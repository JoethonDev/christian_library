<!-- templates/admin/content_detail.html -->
{% extends "layouts/admin_base.html" %}
{% load i18n %}

{% block admin_content %}
<div class="container-fluid px-0">
    <!-- Header Section -->
    <div class="mb-5">
        <div class="d-flex align-items-center mb-3">
            <div class="p-3 rounded-circle me-3" 
                 style="background: linear-gradient(135deg, #800000, #DD9933); backdrop-filter: blur(10px); box-shadow: 0 6px 20px rgba(128,0,0,0.25);">
                <i class="bi bi-journal-text" style="font-size: 2rem; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.3);"></i>
            </div>
            <div>
                <h1 class="h2 mb-1 fw-bold" style="color: #800000; text-shadow: 1px 1px 2px rgba(128,0,0,0.1);">
                    <i class="bi bi-pencil-square me-2" style="color: #DD9933;"></i>{% trans "Sacred Content Details" %}
                </h1>
                <p class="mb-0" style="color: #5a4037;">{% trans "Edit and sanctify content metadata and blessed settings" %}</p>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Meta Information Form -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-lg" style="border-radius: 25px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border: 1px solid rgba(128,0,0,0.1);">
                <div class="card-header bg-transparent border-0 py-4 px-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 fw-bold d-flex align-items-center" style="color: #800000;">
                            <i class="bi bi-pen me-3" style="color: #DD9933;"></i>
                            {% trans "Edit Sacred Content Details" %}
                        </h4>
                        <span class="badge px-3 py-2 rounded-pill {% if content_item.is_active %}text-white{% else %}text-white{% endif %}" 
                              style="background: {% if content_item.is_active %}linear-gradient(135deg, #198754, #20c997){% else %}linear-gradient(135deg, #ffc107, #fd7e14){% endif %}; font-size: 0.875rem; box-shadow: 0 3px 10px {% if content_item.is_active %}rgba(25,135,84,0.3){% else %}rgba(255,193,7,0.3){% endif %};">
                            {% if content_item.is_active %}{% trans "Blessed & Published" %}{% else %}{% trans "Sacred Draft" %}{% endif %}
                        </span>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Sacred Title Section -->
                        <div class="mb-4">
                            <h6 class="text-uppercase fw-bold mb-3" style="color: #800000; letter-spacing: 1px;">
                                <i class="bi bi-fonts me-2" style="color: #DD9933;"></i>{% trans "Sacred Content Titles" %}
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold" style="color: #800000;">{% trans "Arabic Title" %} <span class="text-danger">*</span></label>
                                    <input type="text" name="title_ar" class="form-control border-0 shadow-sm" 
                                           style="border-radius: 15px; background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.08)); padding: 12px 20px; border: 1px solid rgba(128,0,0,0.15);" 
                                           value="{{ content_item.title_ar }}" required dir="rtl">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold" style="color: #DD9933;">{% trans "English Title" %}</label>
                                    <input type="text" name="title_en" class="form-control border-0 shadow-sm" 
                                           style="border-radius: 15px; background: linear-gradient(135deg, rgba(221,153,51,0.05), rgba(221,153,51,0.08)); padding: 12px 20px; border: 1px solid rgba(221,153,51,0.15);" 
                                           value="{{ content_item.title_en }}" dir="ltr">
                                </div>
                            </div>
                        </div>

                        <!-- Sacred Description Section -->
                        <div class="mb-4">
                            <h6 class="text-uppercase fw-bold mb-3" style="color: #800000; letter-spacing: 1px;">
                                <i class="bi bi-card-text me-2" style="color: #DD9933;"></i>{% trans "Sacred Content Descriptions" %}
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold" style="color: #800000;">{% trans "Arabic Description" %}</label>
                                    <textarea name="description_ar" class="form-control border-0 shadow-sm" rows="5" 
                                              style="border-radius: 15px; background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.08)); padding: 15px 20px; border: 1px solid rgba(128,0,0,0.15);" 
                                              dir="rtl">{{ content_item.description_ar }}</textarea>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold" style="color: #DD9933;">{% trans "English Description" %}</label>
                                    <textarea name="description_en" class="form-control border-0 shadow-sm" rows="5" 
                                              style="border-radius: 15px; background: linear-gradient(135deg, rgba(221,153,51,0.05), rgba(221,153,51,0.08)); padding: 15px 20px; border: 1px solid rgba(221,153,51,0.15);" 
                                              dir="ltr">{{ content_item.description_en }}</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Sacred Content Settings -->
                        <div class="mb-4">
                            <h6 class="text-uppercase fw-bold mb-3" style="color: #800000; letter-spacing: 1px;">
                                <i class="bi bi-tags me-2" style="color: #DD9933;"></i>{% trans "Sacred Content Settings" %}
                            </h6>
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label class="form-label fw-bold" style="color: #8B4513;">{% trans "Sacred Tags" %} <small style="color: #5a4037;">({% trans "Comma Separated" %})</small></label>
                                    <input type="text" name="tags" class="form-control border-0 shadow-sm" 
                                           style="border-radius: 15px; background: linear-gradient(135deg, rgba(139,69,19,0.05), rgba(139,69,19,0.08)); padding: 12px 20px; border: 1px solid rgba(139,69,19,0.15);" 
                                           value="{{ current_tags }}" placeholder="{% trans 'e.g. liturgy, hymns, saints, prayers' %}">
                                </div>
                            </div>
                        </div>

                        <!-- Sacred Publish Settings -->
                        <div class="mb-4">
                            <div class="card border-0" style="background: linear-gradient(135deg, rgba(221,153,51,0.05), rgba(221,153,51,0.08)); border-radius: 20px; border: 1px solid rgba(221,153,51,0.15);">
                                <div class="card-body p-4">
                                    <div class="d-flex align-items-center">
                                        <div class="form-check form-switch d-flex align-items-center">
                                            <input class="form-check-input me-3" type="checkbox" name="is_active" id="isActive" 
                                                   style="transform: scale(1.5); accent-color: #DD9933;" {% if content_item.is_active %}checked{% endif %} disabled>
                                            <div>
                                                <label class="form-check-label fw-bold mb-0 text-muted" for="isActive" style="cursor: not-allowed;">
                                                    <i class="bi bi-eye-fill me-2" style="color: #DD9933;"></i>{% trans "Sacred Content Status" %}
                                                </label>
                                                <p class="small mb-0 mt-1" style="color: #5a4037;">{% trans "Status is managed through the Consecration button below" %}</p>
                                            </div>
                                        </div>
                                        <div class="ms-auto">
                                            <button type="submit" name="toggle_active" value="1" 
                                                    class="btn {% if content_item.is_active %}btn-outline-warning{% else %}btn-success{% endif %} rounded-pill px-4">
                                                {% if content_item.is_active %}
                                                    <i class="bi bi-x-circle me-2"></i>{% trans "Deactivate Sacred Content" %}
                                                {% else %}
                                                    <i class="bi bi-check-circle me-2"></i>{% trans "Consecrate & Activate" %}
                                                {% endif %}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sacred Action Buttons -->
                        <div class="d-flex gap-3 pt-3">
                            <button type="submit" class="btn text-white px-4 py-3 rounded-pill fw-bold" 
                                    style="background: linear-gradient(135deg, #800000, #DD9933); border: none; box-shadow: 0 6px 20px rgba(128,0,0,0.3); text-shadow: 0 2px 4px rgba(0,0,0,0.3); transition: all 0.3s ease;">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                {% trans "Save Sacred Changes" %}
                            </button>
                            <a href="{% url 'frontend_api:admin_content_list' %}" class="btn px-4 py-3 rounded-pill fw-bold" 
                               style="color: #6c757d; border: 2px solid rgba(108,117,125,0.3); background: rgba(248,249,250,0.8); transition: all 0.3s ease;">
                                <i class="bi bi-shield-x me-2"></i>
                                {% trans "Cancel Changes" %}
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sacred Technical Metadata Sidebar -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-lg" style="border-radius: 25px; background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); border: 1px solid rgba(128,0,0,0.1);">
                <div class="card-header bg-transparent border-0 py-4 px-4">
                    <h5 class="mb-0 fw-bold d-flex align-items-center" style="color: #800000;">
                        <i class="bi bi-info-circle-fill me-3" style="color: #DD9933;"></i>
                        {% trans "Sacred Technical Metadata" %}
                    </h5>
                </div>
                <div class="card-body p-4">
                    <div class="mb-4">
                        <!-- Sacred Content ID -->
                        <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.08)); border: 1px solid rgba(128,0,0,0.15);">
                            <span class="fw-bold" style="color: #5a4037;">{% trans "Sacred ID" %}</span>
                            <code class="bg-transparent" style="color: #800000; font-weight: bold;">#{{ content_item.id }}</code>
                        </div>

                        <!-- Sacred Content Type -->
                        <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(221,153,51,0.05), rgba(221,153,51,0.08)); border: 1px solid rgba(221,153,51,0.15);">
                            <span class="fw-bold" style="color: #5a4037;">{% trans "Sacred Type" %}</span>
                            <span class="badge px-3 py-2 rounded-pill text-white" style="background: linear-gradient(135deg, #DD9933, #B8860B); box-shadow: 0 3px 10px rgba(221,153,51,0.3);">
                                {{ content_item.get_content_type_display }}
                            </span>
                        </div>

                        {% if meta_data %}
                            <!-- Sacred Processing Status -->
                            <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(139,69,19,0.05), rgba(139,69,19,0.08)); border: 1px solid rgba(139,69,19,0.15);">
                                <span class="fw-bold" style="color: #5a4037;">{% trans "Divine Status" %}</span>
                                <span class="badge px-3 py-2 rounded-pill text-white" style="background: linear-gradient(135deg, #8B4513, #A0522D); box-shadow: 0 3px 10px rgba(139,69,19,0.3);">
                                    {{ meta_data.processing_status }}
                                </span>
                            </div>

                            {% if content_item.content_type == 'video' or content_item.content_type == 'audio' %}
                                <!-- Sacred Duration -->
                                <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.08)); border: 1px solid rgba(128,0,0,0.15);">
                                    <span class="fw-bold" style="color: #5a4037;">{% trans "Sacred Duration" %}</span>
                                    <span class="fw-bold" style="color: #800000;">{{ meta_data.duration_seconds|default:"--" }} sec</span>
                                </div>
                            {% endif %}

                            {% if content_item.content_type == 'pdf' %}
                                <!-- Sacred Page Count -->
                                <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(128,0,0,0.05), rgba(128,0,0,0.08)); border: 1px solid rgba(128,0,0,0.15);">
                                    <span class="fw-bold" style="color: #5a4037;">{% trans "Sacred Pages" %}</span>
                                    <span class="fw-bold" style="color: #800000;">{{ meta_data.page_count|default:"--" }}</span>
                                </div>

                <!-- Indexed Character Count -->
                <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(25,135,84,0.05), rgba(25,135,84,0.08)); border: 1px solid rgba(25,135,84,0.15);">
                    <span class="fw-bold" style="color: #5a4037;">
                        <i class="bi bi-search me-2" style="color: #198754;"></i>{% trans "Indexed Characters" %}
                    </span>
                    {% if content_item.indexed_char_count > 0 %}
                        <span class="fw-bold" style="color: #198754;">{{ content_item.indexed_char_count|floatformat:0 }}</span>
                    {% else %}
                        <span class="fw-bold" style="color: #ffc107;">
                            <i class="bi bi-exclamation-triangle me-1"></i>{% trans "Not Indexed" %}
                        </span>
                    {% endif %}
                </div>

                {% if content_item.book_content %}
                <!-- Indexed Content Section -->
                <div class="mb-3 p-3 rounded-4" style="background: linear-gradient(135deg, rgba(13,110,253,0.05), rgba(13,110,253,0.1)); border: 1px solid rgba(13,110,253,0.2);">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span class="fw-bold" style="color: #0d6efd;">
                            <i class="bi bi-file-earmark-text-fill me-2"></i>{% trans "Extracted Sacred Text" %}
                        </span>
                        <span class="badge bg-primary rounded-pill">{{ content_item.indexed_char_count }} {% trans "chars" %}</span>
                    </div>
                    
                    <!-- Text Preview -->
                    <div class="p-3 rounded-3 mb-2" style="background: white; border: 1px solid rgba(0,0,0,0.05); font-family: 'Amiri', serif; line-height: 1.8; color: #333; direction: rtl; text-align: right;">
                        {{ content_item.book_content|truncatechars:1000|linebreaksbr }}
                    </div>

                    {% if content_item.indexed_char_count > 1000 %}
                    <div class="mt-2">
                        <button class="btn btn-sm btn-outline-primary rounded-pill w-100 fw-bold py-2" type="button" data-bs-toggle="collapse" data-bs-target="#fullContentCollapse" aria-expanded="false" aria-controls="fullContentCollapse">
                            <i class="bi bi-arrows-expand me-2"></i>{% trans "Reveal Full Sacred Text" %}
                        </button>
                        <div class="collapse mt-3" id="fullContentCollapse">
                            <div class="card card-body p-4 rounded-4 shadow-sm" style="max-height: 600px; overflow-y: auto; font-family: 'Amiri', serif; line-height: 2.0; direction: rtl; text-align: right; background: #fffaf5;">
                                {{ content_item.book_content|linebreaksbr }}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            {% endif %}

            <!-- Sacred File Size -->
            <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded-3" style="background: linear-gradient(135deg, rgba(221,153,51,0.05), rgba(221,153,51,0.08)); border: 1px solid rgba(221,153,51,0.15);">
                <span class="fw-bold" style="color: #5a4037;">{% trans "Blessed Size" %}</span>
                <span class="fw-bold" style="color: #DD9933;">
                    {% if meta_data.get_safe_file_size %}
                        {{ meta_data.get_safe_file_size|filesizeformat }}
                    {% else %}
                        {% trans "Awaiting blessing" %}
                    {% endif %}
                </span>
            </div>
                        {% endif %}
                    </div>
                    
                    <hr class="my-4" style="border-color: rgba(128,0,0,0.2);">
                    
                    <!-- Sacred Danger Zone -->
                    <div class="text-center">
                        <h6 class="text-uppercase fw-bold mb-3" style="color: #dc3545; letter-spacing: 1px;">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>{% trans "Sacred Removal Zone" %}
                        </h6>
                        <a href="{% url 'frontend_api:content_delete_confirm' content_item.id %}" 
                           class="btn text-white px-4 py-3 rounded-pill fw-bold w-100" 
                           style="background: linear-gradient(135deg, #dc3545, #e55353); border: none; box-shadow: 0 6px 20px rgba(220,53,69,0.4); text-shadow: 0 2px 4px rgba(0,0,0,0.3); transition: all 0.3s ease;"
                           >
                            <i class="bi bi-trash-fill me-2"></i> 
                            {% trans "Remove Sacred Content" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}