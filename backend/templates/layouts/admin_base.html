<!-- templates/layouts/admin_base.html - Standalone Modern Admin Theme -->
{% load i18n static %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}

<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" dir="{{ LANGUAGE_BIDI|yesno:'rtl,ltr' }}" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% trans "Admin Panel" %} | {% trans "Christian Library" %}{% endblock %}</title>

    <!-- Google Fonts (Inter for UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    {% if LANGUAGE_BIDI %}
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    {% else %}
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    {% endif %}

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    {% block extra_head %}{% endblock %}

    <style>
        :root {
            /* Modern Admin Color Palette (Soft UI) */
            --admin-primary: #005f5f;       /* Teal */
            --admin-primary-dark: #004c4c;
            --admin-secondary: #6c757d;     /* Gray */
            --admin-success: #198754;       /* Green */
            --admin-info: #0dcaf0;          /* Cyan */
            --admin-warning: #ffc107;       /* Yellow */
            --admin-danger: #dc3545;        /* Red */
            
            --admin-bg: #f5f7f9;            /* Light Gray BG */
            --admin-card-bg: #ffffff;
            --admin-text: #344767;          /* Dark Blue-Gray */
            --admin-text-muted: #8392ab;
            
            --admin-sidebar-width: 260px;
            --font-admin: 'Inter', system-ui, -apple-system, sans-serif;
        }

        body {
            font-family: var(--font-admin);
            background-color: var(--admin-bg);
            color: var(--admin-text);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        /* Links */
        a { text-decoration: none; }
        
        /* Sidebar */
        .admin-sidebar {
            width: var(--admin-sidebar-width);
            background: #ffffff;
            border-right: 1px solid rgba(0,0,0,0.05);
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0; /* Left for LTR, Right for RTL via logic below */
            z-index: 1040;
            transition: transform 0.3s ease-in-out;
            overflow-y: auto;
            box-shadow: 0 0 15px rgba(0,0,0,0.02);
        }

        /* RTL Sidebar support via CSS Logic or direction attribute */
        html[dir="rtl"] .admin-sidebar {
            left: auto;
            right: 0;
            border-right: none;
            border-left: 1px solid rgba(0,0,0,0.05);
        }

        .admin-brand {
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            background: var(--admin-primary);
            color: white;
        }

        .nav-link-admin {
            display: flex;
            align-items: center;
            padding: 0.85rem 1.5rem;
            color: var(--admin-text);
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            border-left: 3px solid transparent; /* LTR */
        }
        
        html[dir="rtl"] .nav-link-admin {
            border-left: none;
            border-right: 3px solid transparent;
        }

        .nav-link-admin:hover {
            background-color: #f8f9fa;
            color: var(--admin-primary);
        }

        .nav-link-admin.active {
            background-color: rgba(0, 95, 95, 0.05);
            color: var(--admin-primary);
            border-color: var(--admin-primary);
        }

        .nav-link-icon {
            width: 24px;
            text-align: center;
            margin-right: 10px; /* LTR */
            font-size: 1.1rem;
        }
        
        html[dir="rtl"] .nav-link-icon {
            margin-right: 0;
            margin-left: 10px;
        }

        .admin-section-label {
            padding: 1.5rem 1.5rem 0.5rem;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--admin-text-muted);
            letter-spacing: 0.05em;
        }

        /* Main Content Wrapper */
        .admin-main {
            flex-grow: 1;
            margin-left: var(--admin-sidebar-width); /* LTR */
            transition: margin 0.3s ease-in-out;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        html[dir="rtl"] .admin-main {
            margin-left: 0;
            margin-right: var(--admin-sidebar-width);
        }

        /* Top Navbar */
        .admin-topbar {
            height: 70px;
            background: white; /* Glass effect if desired, standard white for now */
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding: 0 2rem;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        /* Content Container */
        .admin-content {
            padding: 2rem;
            flex: 1;
        }
        
        /* Utils */
        .bg-gradient-primary {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-primary-dark) 100%);
        }
        
        /* Card Soft UI */
        .card {
            box-shadow: 0 0.25rem 0.375rem -0.0625rem rgba(0, 0, 0, 0.05), 0 0.125rem 0.25rem -0.0625rem rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* Mobile Responsive */
        @media (max-width: 991.98px) {
            .admin-sidebar {
                transform: translateX(-100%);
            }
            html[dir="rtl"] .admin-sidebar {
                transform: translateX(100%);
            }
            
            .admin-sidebar.show {
                transform: translateX(0);
            }
            
            .admin-main {
                margin-left: 0 !important;
                margin-right: 0 !important;
                width: 100%;
            }
            
            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1035;
                display: none;
            }
            .mobile-overlay.show {
                display: block;
            }
        }
    </style>
</head>
<body class="d-flex flex-column" x-data="{ sidebarOpen: false }">

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" :class="{ 'show': sidebarOpen }" @click="sidebarOpen = false"></div>

    <!-- Sidebar -->
    <aside class="admin-sidebar d-flex flex-column" :class="{ 'show': sidebarOpen }">
        <div class="admin-brand">
            <div class="d-flex align-items-center">
                <i class="bi bi-shield-lock me-2 fs-4"></i>
                <span class="fw-bold h5 mb-0">{% trans "Admin" %}</span>
            </div>
        </div>

        <nav class="py-3 flex-grow-1">
            <a href="{% url 'frontend_api:admin_dashboard' %}" 
               class="nav-link-admin {% if 'dashboard' in request.path %}active{% endif %}">
                <i class="bi bi-speedometer2 nav-link-icon"></i>
                {% trans "Dashboard" %}
            </a>
            
            <a href="{% url 'frontend_api:upload_content' %}" 
               class="nav-link-admin {% if 'upload' in request.path %}active{% endif %}">
                <i class="bi bi-cloud-upload nav-link-icon"></i>
                {% trans "Upload Content" %}
            </a>

            <div class="admin-section-label">{% trans "Content Management" %}</div>
            
            <a href="{% url 'frontend_api:admin_content_list' %}" 
               class="nav-link-admin {% if 'content' in request.path and 'upload' not in request.path %}active{% endif %}">
                <i class="bi bi-collection nav-link-icon"></i>
                {% trans "All Content" %}
            </a>
            
            <a href="{% url 'frontend_api:video_management' %}" 
               class="nav-link-admin {% if 'videos' in request.path %}active{% endif %}">
                <i class="bi bi-camera-video nav-link-icon"></i>
                {% trans "Videos" %}
            </a>
            
            <a href="{% url 'frontend_api:audio_management' %}" 
               class="nav-link-admin {% if 'audios' in request.path %}active{% endif %}">
                <i class="bi bi-mic nav-link-icon"></i>
                {% trans "Audio" %}
            </a>
            
            <a href="{% url 'frontend_api:pdf_management' %}" 
               class="nav-link-admin {% if 'pdfs' in request.path %}active{% endif %}">
                <i class="bi bi-file-text nav-link-icon"></i>
                {% trans "PDFs" %}
            </a>

            <div class="admin-section-label">{% trans "Analytics & System" %}</div>
            
            <a href="{% url 'frontend_api:seo_dashboard' %}" 
               class="nav-link-admin {% if 'seo' in request.path %}active{% endif %}">
                <i class="bi bi-graph-up-arrow nav-link-icon"></i>
                {% trans "SEO Dashboard" %}
            </a>
            
            <a href="{% url 'frontend_api:system_monitor' %}" 
               class="nav-link-admin {% if 'system' in request.path %}active{% endif %}">
                <i class="bi bi-cpu nav-link-icon"></i>
                {% trans "System Monitor" %}
            </a>
        </nav>
        
        <div class="p-3 border-top mt-auto">
            <a href="{% url 'frontend_api:home' %}" class="btn btn-outline-secondary w-100 rounded-3">
                <i class="bi bi-box-arrow-up-right me-2"></i>{% trans "View Site" %}
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <main class="admin-main">
        <!-- Top Header -->
        <header class="admin-topbar justify-content-between">
            <div class="d-flex align-items-center">
                <button class="btn btn-link text-dark d-lg-none p-0 me-3" @click="sidebarOpen = !sidebarOpen">
                    <i class="bi bi-list fs-2"></i>
                </button>
                <div class="d-none d-md-block text-muted small">
                    {% now "l, F j, Y" %}
                </div>
            </div>
            
            <div class="d-flex align-items-center gap-3">
                {% if request.user.is_authenticated %}
                <div class="dropdown">
                   <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle text-dark" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                       <span class="me-2 d-none d-md-inline small fw-semibold">{{ request.user.username }}</span>
                       <div class="bg-secondary rounded-circle d-flex align-items-center justify-content-center text-white small" style="width: 32px; height: 32px;">
                           <i class="bi bi-person-fill"></i>
                       </div>
                   </a>
                   <ul class="dropdown-menu dropdown-menu-end shadow border-0" aria-labelledby="dropdownUser">
                       <li><a class="dropdown-item" href="{% url 'frontend_api:home' %}">{% trans "Back to Website" %}</a></li>
                       <li><hr class="dropdown-divider"></li>
                       <li>
                           <form method="post" action="{% url 'admin:logout' %}">
                               {% csrf_token %}
                               <button type="submit" class="dropdown-item text-danger">{% trans "Sign out" %}</button>
                           </form>
                       </li>
                   </ul>
                </div>
                {% endif %}
            </div>
        </header>

        <!-- Dynamic Content -->
        <div class="admin-content">
            {% if messages %}
            <div class="messages mb-4">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show border-0 shadow-sm" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            {% block admin_content %}{% endblock %}
        </div>
        
        <footer class="mt-auto py-3 px-4 border-top bg-white">
            <div class="d-flex justify-content-between align-items-center small text-muted">
                <span>&copy; {% now "Y" %} Christian Library Admin</span>
                <span>v2.0</span>
            </div>
        </footer>
    </main>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast border-0 shadow-lg" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header border-0">
                <i class="bi bi-info-circle-fill me-2 text-primary" id="toastIcon"></i>
                <strong class="me-auto" id="toastTitle">{% trans "Notification" %}</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- Message goes here -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal (Reusable) -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">{% trans "Confirm Action" %}</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmationMessage">{% trans "Are you sure you want to perform this action?" %}</p>
                    <div id="confirmationDetails" class="alert alert-info small" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Cancel" %}</button>
                    <button type="button" class="btn btn-primary" id="confirmActionBtn">{% trans "Confirm" %}</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        /**
         * Generic notification helper to replaces standard window.alert()
         * @param {string} message - The message to display
         * @param {string} type - 'success', 'danger', 'info', 'warning'
         */
        window.showToast = function(message, type = 'info') {
            const toastEl = document.getElementById('liveToast');
            const toastMessage = document.getElementById('toastMessage');
            const toastTitle = document.getElementById('toastTitle');
            const toastIcon = document.getElementById('toastIcon');
            
            // Set message
            toastMessage.textContent = message;
            
            // Set styling based on type
            toastEl.className = 'toast border-0 shadow-lg';
            toastIcon.className = 'bi me-2';
            
            if (type === 'danger' || type === 'error') {
                toastEl.classList.add('bg-danger', 'text-white');
                toastTitle.className = 'me-auto text-white';
                toastIcon.classList.add('bi-exclamation-triangle-fill', 'text-white');
                toastTitle.textContent = '{% trans "Error" %}';
                // Update close button for dark background
                toastEl.querySelector('.btn-close').classList.add('btn-close-white');
            } else if (type === 'success') {
                toastEl.classList.add('bg-success', 'text-white');
                toastTitle.className = 'me-auto text-white';
                toastIcon.classList.add('bi-check-circle-fill', 'text-white');
                toastTitle.textContent = '{% trans "Success" %}';
                toastEl.querySelector('.btn-close').classList.add('btn-close-white');
            } else if (type === 'warning') {
                toastEl.classList.add('bg-warning', 'text-dark');
                toastTitle.className = 'me-auto text-dark';
                toastIcon.classList.add('bi-exclamation-circle-fill', 'text-dark');
                toastTitle.textContent = '{% trans "Warning" %}';
                toastEl.querySelector('.btn-close').classList.remove('btn-close-white');
            } else {
                toastEl.classList.add('bg-white', 'text-dark');
                toastTitle.className = 'me-auto text-primary';
                toastIcon.classList.add('bi-info-circle-fill', 'text-primary');
                toastTitle.textContent = '{% trans "Info" %}';
                toastEl.querySelector('.btn-close').classList.remove('btn-close-white');
            }
            
            const toast = new bootstrap.Toast(toastEl, { delay: 5000 });
            toast.show();
        };

        /**
         * Show confirmation modal
         * @param {string} message - The confirmation message
         * @param {string} details - Additional details to show (optional)
         * @param {function} onConfirm - Callback function when confirmed
         */
        window.showConfirmation = function(message, details, onConfirm) {
            const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            const confirmBtn = document.getElementById('confirmActionBtn');
            const messageEl = document.getElementById('confirmationMessage');
            const detailsEl = document.getElementById('confirmationDetails');
            
            messageEl.textContent = message;
            
            if (details) {
                detailsEl.innerHTML = details;
                detailsEl.style.display = 'block';
            } else {
                detailsEl.style.display = 'none';
            }
            
            // Remove old event listeners
            const newConfirmBtn = confirmBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            
            // Add new event listener
            newConfirmBtn.addEventListener('click', function() {
                modal.hide();
                if (typeof onConfirm === 'function') {
                    onConfirm();
                }
            });
            
            modal.show();
        };

        // Override default alert if we want to be aggressive, 
        // but it's better to explicitly use showToast in our code.
        // window.alert = (msg) => window.showToast(msg, 'info');
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>